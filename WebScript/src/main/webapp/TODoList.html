<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>í• ì¼ ëª©ë¡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div id="main" class="container mt-5 mb-3">
        <h3 class="mb-3">ğŸ“TODO List</h3>
        <input id="list-item" type="text" placeholder="í• ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required />
        <button id="btn-add" class="btn btn-primary btn-sm align-top" type="button" title="í• ì¼ ì¶”ê°€">
        ì¶”ê°€
        </button>
        <div id="content" class="mt-3">
        <!-- ì—¬ê¸°ì— ì¶”ê°€ì‹œí‚´ -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript">
    	let content = document.getElementById("content");
    	let inputListItem = document.getElementById("list-item"); //ì…ë ¥ê°’ ì½ì–´ì˜¤ëŠ”ë° í•„ìš”
    	// ì¶”ê°€ë²„íŠ¼ ìš”ì†Œê°ì²´ ì£¼ì†Œ(ì°¸ì¡°)ë³€ìˆ˜ì— ì €ì¥
    	let btnAdd = document.getElementById("btn-add");// ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë“±ë¡
    	const ul = document.createElement("ul"); // ë¯¸ë¦¬ ìƒì„±í•˜ê³  lië§Œ ì¶”ê°€
		ul.className = "list-group"; //-> ë¶€íŠ¸ìŠ¤íŠ¸ë© listê·¸ë£¹ ì ìš©
		
		//ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ëŠ” ë¬¸ìì—´ë§Œ ì €ì¥ì´ ê°€ëŠ¥í•˜ë‹¤! 
		//-> (ê°ì²´ ë˜ëŠ” ë°°ì—´ì€) JSONìœ¼ë¡œ ë³€í™˜í•´ì•¼í•¨ JSON.stringify()
		// êº¼ë‚´ì„œ ì“¸ ë• ê·¸ ë°˜ëŒ€ JSON ë¬¸ìì—´-> ê°ì²´/ë°°ì—´ë¡œ ë³€í™˜ JSON.parse()
		//ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë¡œë“œ
		const toDoList= JSON.parse(localStorage.getItem("toDoList")) || [];
    	//ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ í‚¤ê°€ todolistë¥¼ ì°¾ëŠ”ë° ì—†ìœ¼ë©´ ë¹ˆë°°ì—´ë¡œ(ê°ì²´ë°°ì—´ì‚¬ìš©)
    	
    	//í™”ë©´ì— ë¿Œë¦¬ê¸° - ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥ëœê±¸ í™”ë©´ì— ë¿Œë¦¼
        function writeToDo() {
            ul.innerHTML = ""; // ê¸°ì¡´ í™”ë©´ ì´ˆê¸°í™”
            toDoList.forEach(item => {
                const li = document.createElement("li");
                li.className = "list-group-item";
                li.id = item.liid;
        
                const checkBox = document.createElement("input");
                checkBox.type = "checkbox";
                checkBox.className = "form-check-input me-1";
                checkBox.checked = item.done; // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ì²´í¬ ì—¬ë¶€ ì ìš©
        
                const label = document.createElement("label");
                label.className = "form-check-label ms-1";
                label.innerHTML = item.text;
        
                // ì²´í¬ ìƒíƒœ ìŠ¤íƒ€ì¼ ì ìš©
                if(item.done){
                    label.style.color = "gray";
                    label.style.textDecoration = "line-through";
                }
        
                // ìˆ˜ì • ë²„íŠ¼
                const btnUpdate = document.createElement("button");
                btnUpdate.className = "btn btn-sm btn-outline-info ms-2 me-1";
                btnUpdate.innerHTML = "ìˆ˜ì •";
        
                // ì‚­ì œ ë²„íŠ¼
                const btnDelete = document.createElement("button");
                btnDelete.className = "btn btn-sm btn-outline-danger";
                btnDelete.innerHTML = "ì‚­ì œ";
        
                li.appendChild(checkBox);
                li.appendChild(label);
                li.appendChild(btnUpdate);
                li.appendChild(btnDelete);
                ul.appendChild(li);
                
                //ìˆ˜ì •ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡
                btnUpdate.addEventListener("click", () => {
					const btnSuccess = document.createElement("button");
					btnSuccess.className = "btn btn-sm btn-outline-success me-1";
					btnSuccess.innerHTML = "ì™„ë£Œ";
                    const input = document.createElement("input");
                    input.type = "text";
                    input.value = label.innerHTML;
                    input.className = "form-control d-inline w-50 me-2 ms-2";

                    li.replaceChild(input, label);
                    li.replaceChild(btnSuccess, btnUpdate);
                    input.focus();

                    btnSuccess.addEventListener("click", () => {
                            label.innerHTML = input.value;
                            li.replaceChild(label, input); // ë‹¤ì‹œ ë°”ê¿ˆ
                            li.replaceChild(btnUpdate, btnSuccess);
                            // ë°°ì—´ê³¼ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸
                            for(let i = 0; i < toDoList.length; i++){
                                if(toDoList[i].liid == li.id){
                                    toDoList[i].text = input.value;
                                    localStorage.setItem("toDoList", JSON.stringify(toDoList));
                                }
                            }
                    });
                });
                
                //ì‚­ì œë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡
                btnDelete.addEventListener("click", () => {
					if(confirm("ì‚­ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
						// toDoListì—ì„œ í•´ë‹¹ ì•„ì´í…œ ì œê±°
	                    for (let i = 0; i < toDoList.length; i++) {
	                        if (toDoList[i].liid == li.id) {
	                            toDoList.splice(i, 1); // ë°°ì—´ì—ì„œ ì œê±°(ië²ˆ ì¸ë±ìŠ¤ë¶€í„° 1ê°œ ì‚­ì œí•œë‹¤ëŠ” ëœ»)
	                            break;
	                        }
	                    }
	                    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê°±ì‹ 
	                    localStorage.setItem("toDoList", JSON.stringify(toDoList));
	                    writeToDo(); // ë‹¤ì‹œ í™”ë©´ ê·¸ë¦¬ê¸°
					}
                });
        
                // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë“±ë¡
                checkBox.addEventListener("change", (event) => {
                    const checked = event.target.checked;
        
                    for(let i = 0; i < toDoList.length; i++){
                        if(toDoList[i].liid == li.id){
                            toDoList[i].done = checked;
                            localStorage.setItem("toDoList", JSON.stringify(toDoList));
                        }
                    }
        
                    if(checked){
                        label.style.color = "gray";
                        label.style.textDecoration = "line-through";
                    } else {
                        label.style.color = "";
                        label.style.textDecoration = "";
                    }
                });
            });
        
            content.appendChild(ul);
        }
    	
    	// ì´ë²¤íŠ¸ ë“±ë¡
        document.addEventListener("DOMContentLoaded", function() { // HTML êµ¬ì¡°ë§Œ ì½ìœ¼ë©´ ë°”ë¡œ ì‹¤í–‰
            writeToDo(); // í™”ë©´ ë¿Œë¦¬ê¸°
        });
    	
        
		// ì´ë²¤íŠ¸ ë“±ë¡ - ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰
        btnAdd.addEventListener("click",() => {
        	if(inputListItem.value.trim() === ""){ // ê°’ì´ ì—†ìœ¼ë©´ 
				alert("í• ì¼ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.");
				return;
			}
        	
        	const createTime = Date.now();
        	// ê°ì²´ë°°ì—´ì— ì €ì¥
        	toDoList.push({liid: createTime, text: inputListItem.value, done: false}); // doneì€ ì²´í¬ë°•ìŠ¤ ìƒíƒœ
        	
        	//ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ - JSê°ì²´(í‚¤ì™€ ê°’ ìŒìœ¼ë¡œ êµ¬ì„±, ê°’ì—ëŠ” ìˆ«ì,ë¬¸ìì—´,ë‹¤ë¥¸ê°ì²´,ë°°ì—´,í•¨ìˆ˜ ë“± ê°€ëŠ¥)
        	//JSONì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°ì²´ë¥¼ ë¬¸ìì—´ë¡œ í‘œí˜„í•œ ê²ƒ
        	localStorage.setItem("toDoList",JSON.stringify(toDoList));
        	inputListItem.value = "";
        	writeToDo();// í™”ë©´ ë¿Œë¦¬ê¸°
        });
		
		
		
    </script>
</body>
</html>